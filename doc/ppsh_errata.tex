%\documentclass[a4paper,12pt]{report}
\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[spanish]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{multirow}
%\usepackage{makeidx}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{float}
\usepackage{enumerate}
\usepackage[toc,page]{appendix}
\usepackage[nottoc]{tocbibind}
\usepackage{color}
\usepackage[dvipsnames]{xcolor}
\definecolor{gray97}{gray}{.97}
\definecolor{gray75}{gray}{.75}
\definecolor{gray45}{gray}{.45}
\usepackage{listings}
\lstset{ frame=Ltb,
	framerule=0pt,
	aboveskip=0.5cm,
	framextopmargin=3pt,
	framexbottommargin=3pt,
	framexleftmargin=0.4cm,
	framesep=0pt,
	rulesep=.4pt,
	backgroundcolor=\color{gray97},
	rulesepcolor=\color{black},
	%
	stringstyle=\ttfamily,
	showstringspaces = false,
	basicstyle=\small\ttfamily,
	commentstyle=\color{gray45},
	keywordstyle=\bfseries,
	%
	numbers=left,
	numbersep=15pt,
	numberstyle=\tiny,
	numberfirstline = false,
	breaklines=true,
}

% minimizar fragmentado de listados
\lstnewenvironment{listing}[1][]
{\lstset{#1}\pagebreak[0]}{\pagebreak[0]}

\lstdefinestyle{consola}
{basicstyle=\scriptsize\bf\ttfamily,
	backgroundcolor=\color{gray75},
}

\lstdefinestyle{C}
{language=C,
}
\usepackage[top=2cm]{geometry}
\pretolerance=2000
\tolerance=3000

% ------------- Inicio paquetes adicionales fjp ----------------
%
% Inicio todonotes: Para usar el comando todonotes
%\usepackage{todonotes}
%\usepackage[disable]{todonotes}
\usepackage[]{todonotes}

% Use more than one optional parameter in a new commands
\usepackage{xargs}
%\usepackage[pdftex,dvipsnames]{xcolor}  % Coloured text etc.
% 
%\usepackage[colorinlistoftodos,prependcaption,textsize=tiny]{todonotes}
% Fin todonotes: Para usar el comando todonotes

% Inicio comment: Para comentar trozos del documento
\usepackage{comment}
% 
% 2   Usage:
% The ‘comment’ environment is defined by default: all text included between
% \begin{comment}
% ...
% \end{comment}
% is discarded.
% The opening and closing commands should appear on a line of their own. No starting
% spaces, nothing after it. This environment should work with arbitrary amounts of
% comment, and the comment can be arbitrary text.
%
% Si no haces esto aparece el error:
% latex error File ended while scanning use of \next.
%
% Fin comment: Para comentar trozos del documento
%

% Para incluir matrices con labels y bloques
\usepackage{blkarray}
\usepackage{multirow}

% Para incluir grafos
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,positioning}
\usetikzlibrary{automata,arrows,positioning,calc}
%With PGF/TikZ version 3.0.0 there's a babel library that solves the problems produced by changes to category codes made by some babel modules
\usetikzlibrary{babel}

% para usar dcases
\usepackage{mathtools} 

% Para incluir codigo y con suerte formatearlo
\usepackage{listings}

\usepackage{color}

\definecolor{eclipse-keywords}{rgb}{0.55,0,0.337}
\definecolor{eclipse-strings}{rgb}{0.165,0,1}
\definecolor{eclipse-comments}{rgb}{0.247,0.498,0.373}



% Para incluir el paquete lpform: Linear Programming Formulas
% The ‘lpform.sty’ file should also be in the same folder as your .tex file.
\usepackage{lpform}
% When adding equations inside the lpformulation environment, itis important that there are NO empty lines, as this will cause an error to occur.

% Para ajustar tabla grade a pagina
\usepackage{adjustbox}


% ------------- Fin paquetes adicionales fjp ----------------


\begin{document}
	
% Instruccion para dar formato al codigo OPL
\lstdefinelanguage[]{OPL}%
{
	classoffset=0,
	keywords={maximize, minimize, subject, to, for, forall, sum, solve, int, int+, float, float+, dvar, boolean, enum, ftoi, mod, abs, maxint, sqrt, ceil, floor, distToInt, frac, trunc, infinity, first, last, card, ord, next, prev, range, in, struct, prod, min, max, union, inter, not, initialize, var, dmin, dmax, dsize, bound, dnexthigher, alldifferent, circuit, distribute, try, endtry, tryall, if, endif, then, else, while, select, once, search, when, onValue, generate, generationMin, generationMax, generateSeq, writeln, execute},
	%keywordstyle=\color{eclipse-keywords}\bfseries,
	keywordstyle=\color{blue}, %\bfseries,
	classoffset=1,
	morekeywords={..,=,<,>,<=,=>,==},
	keywordstyle=\color{black}\bfseries,
	classoffset=0,
	comment=[l][\color{eclipse-comments}]{//},%
	morecomment=[s][\color{eclipse-comments}]{/*}{*/},%
	string=[b][\color{eclipse-strings}]\``,%
	morestring=[b][\color{eclipse-strings}]',%
	basicstyle=\small, %\sffamily,
	tabsize=4,
	showstringspaces=false,
	numbers=none, %left, %% number lines
	numberstyle=\tiny, %% the style of the numbers in the side
	numberblanklines=true,
	showspaces=false,
	showtabs=false,
}[keywords,comments,strings]% 



\begin{titlepage}
	\begin{sffamily}
		\color{NavyBlue}
		\begin{center}
			%\vspace*{-1cm}
			\begin{figure}[htb]
				\begin{center}
					\vspace*{0.6cm}
					%\includegraphics[width=15cm]{logoEHU_blanco_mediano.ps}
					\includegraphics[width=15cm]{logoEHU_blanco_mediano.eps}
					\vspace*{1.6cm}
				\end{center}
			\end{figure}
			\begin{LARGE}
				Máster Universitario en Modelización e Investigación Matemática, Estadística y Computación 
				2018/2019 \\%indicar el curso académico
				\vspace*{1cm}
				\textsl{Personnel and Patient Scheduling in the High Demanded
					Hospital Services: A Case Study in the Physiotherapy Service}\\
			\end{LARGE}
			\Huge{\textbf{ERRATA}}\\ %Más significativo que el anterior
			\vspace*{1cm}
			\rule{80mm}{0.1mm}\\
			\huge{F. Javier Pérez Ramírez}\\ %Separar cada autor con \\ 
			\vspace*{0.5cm}
			\begin{Large}
				Bilbao julio 2023\\
			\end{Large}
		\end{center}
	\end{sffamily}
\end{titlepage}

%\frontmatter
\pagestyle{fancy}
\fancyhead{} % Clear all header fields
\setlength\headheight{21.2pt}
\rhead{\color{NavyBlue} Airoa crew rostering} %Poner encabezado

\renewcommand{\tablename}{\textbf{Tabla}} %para poner la palabra en mayuscula
\renewcommand{\figurename}{\textbf{Figura}} % para poner la palabra en mayuscula
\renewcommand{\listtablename}{Índice de tablas}

\title{}
\date{}
\maketitle


\clearpage
\pagenumbering{Roman}
\setcounter{page}{1}

\tableofcontents
%\thispagestyle{empty}

%\listoffigures
%\thispagestyle{empty}

%\listoftables
%\thispagestyle{empty}

%Para imagenes
%\begin{figure}[H]
%\centering
%\includegraphics[scale=0.8]{imagenes/*.png}
%\caption{}
%\end{figure}



%\mainmatter
\clearpage
\pagenumbering{arabic}
\setcounter{page}{1}


% -------------- Inicio comandos adicionales fjp -----------------------------
%
% Para incluir comentarios
\newcommandx{\unsure}[2][1=]{\todo[inline,linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}}
\newcommandx{\info}[2][1=]{\todo[inline,linecolor=green,backgroundcolor=green!25,bordercolor=green,#1]{#2}}
%
%
% -------------- fin comandos adicionales fjp -----------------------------



%Comenzar el trabajo

%\chapter{Problemas de Modelos de logística. Bloque 2.}
There are some errata in the paper: Personnel and Patient Scheduling in the High Demanded. Hospital Services: A Case Study in the Physiotherapy Service. By S. Noyan Ogulata, Melik Koyuncu, Esra Karakas\cite{ogulata2008personnel}.

\section{Paper proposed model with fixed errata}
We show here paper proposed model and definitions. But we think that there are some errata in some equations and we will propose new equations to fix those problems.

The notation used in this study is as follows:
\begin{description}
	\item[$N$] Number of patients. $N \in \mathbb{N} > 0$
	\item[$n$] Number of selected patients. $n \in \mathbb{N} > 0$
	\item[$S$] Number of physiotherapists. $S \in \mathbb{N} > 0$
	\item[$m$] Number of time intervals. $m \in \mathbb{N} > 0$
	\item[$c$] Maximum number of patients assigned to each physiotherapist. $c \in \mathbb{N} > 0$
	\item[$i$] Patient number index. $i \in N$ or $i \in n$
	\item[$j$] Physiotherapist number. $j \in S$
	\item[$l$] Time intervals number. $l \in m$
	\item[$k$] Time category number. $k \in  \mathbb{N} > 0$
	\item[$h$] Daily work minutes per each physiotherapist. $h \in  \mathbb{N} \ge 0$
	\item[$t_i$] Treatment time of $i$th patient. $t_i \in  \mathbb{N} > 0$
	\item[$T$] Total daily capacity. $T \in  \mathbb{N} > 0$
	\item[$p_i$] Weight of priority level for $i$th patient. $p_i \in  \mathbb{N} > 0$
	\item[$G_j$] Total physiotherapy time assigned to $j$th physiotherapist. $G_i \in  \mathbb{N} \ge 0$
	\item[$\overline{G}$] Average physiotherapy time assigned to physiotherapists. $\overline{G} \in  \mathbb{R} \ge 0$
	\item[$N_{jk}$] Number of patients assigned to $j$th physiotherapist from $k$th time category. $N_{jk} \in  \mathbb{N} \ge 0$
	\item[$\overline{N}_k$] Average number of patients assigned from $k$th time category. $\overline{N}_k \in  \mathbb{R} \ge 0$
	\item[$tc_i$] Time category for ith patients. (1 = short, 2 = long)$G_i \in \{1, 2\}$
	\item[$TI_l$] Total physiotherapy time assigned to $l$th time intervals. $TI_l \in  \mathbb{N} \ge 0$
	\item[$\overline{TI}$] Average physiotherapy time assigned to time intervals. $\overline{TI} \in  \mathbb{R} \ge 0$
\end{description}

The variables used in this study are:
\begin{description}
	\item[$x_i$] 1 if $i$th patient is selected; 0 otherwise.
	\item[$y_{ij}$] 1 if $i$th patient is assigned to $j$th physiotherapist; 0 otherwise.
	\item[$z_{il}$] 1 if $i$th patient is assigned to $l$th time intervals; 0 otherwise.
\end{description}

And the right equations are:

Stage I: Patient Acceptance Planning.
\begin{lpformulation}
	\lpobj[eq:obj1]{max}{\sum_{i=1}^N p_i x_i}
	\lpeq[eq:constr01]{\sum_{i=1}^{N} x_i t_i \le T}{}
\end{lpformulation}


Stage II: Assignment to Physiotherapists

\begin{lpformulation}
	\lpobj[eq:obj2]{min}{W_1 d_1^+ + W_2 d_2^+ + W_3 d_3^+ + W_4 d_4^+ + W_5 d_4^-}
	\lpeq[eq:constr04]{d_1^+ = \sum_{i=1}^{S} \lvert  G_j - \overline{G} \rvert}{}\footnotemark
	\lpeq[eq:constr05]{G_j = \sum_{i=1}^{n} t_i y_{ij}}{j \in \{1, \ldots , S\}}
	\lpeq[eq:constr06]{\overline{G} = \sum_{j=1}^{S} G_j/S}{}\footnotemark
	\lpeq[eq:constr07]{d_{k+1}^{+} = \sum_{j=1}^{S} \lvert N_{jk} - \overline{N} \rvert ,}{k \in \{1,2\}}\footnotemark
	\lpnewsubeq[eq:constr08a]{N_{jk} = \sum_{i | tc_i = k} y_{ij},}{j \in \{1, \ldots , S\}, k \in \{1,2\}}
	\lpsubeq[eq:eq:constr08b]{0 \le \sum_{k \in \{1,2\}} N_{jk} \le c,}{j \in \{1, \ldots , S\}}
	\lpeq[eq:constr09]{\overline{N}_k = \sum_{j=1}^{S} N_{jk}/S,}{k \in \{1,2\}}
	\lpnewsubeq[eq:constr10a]{d_4^+ = \sum_{i=1}^{n} \sum_{j=1}^{S} y_{ij} t_i}{}\footnotemark
	\lpsubeq[eq:constr10b]{d_4^- = h S - d_4^+}{}
	\lpeq[eq:constr11]{\sum_{j=1}^{S} y_{ij} = 1,}{i \in \{1, \ldots , n\}}\footnotemark
	\lpeq[eq:constr12] {0 \le G_j \le h,}{j \in \{1, \ldots , S\}}
\end{lpformulation}

\footnotetext{The equation number (\ref{eq:constr04}) will be changed later in section \ref{sec:absolute}.}

\footnotetext{The equation number (\ref{eq:constr06}) in the paper was:
		\begin{lpformulation}
			\lpeq*{\overline{G} = \sum_{i=1}^{n} G_j/S}{j \in \{1, \ldots , S\}}
		\end{lpformulation}
		It  had a $n$ in the summation index and it is wrong.}

\footnotetext{The equation number (\ref{eq:constr07}) will be changed later in section \ref{sec:absolute}.}

\footnotetext{The equations number (\ref{eq:constr10a}) and (\ref{eq:constr10b}) in the paper was only one equation:
	\begin{lpformulation}
		\lpeq*{d_{4}^{+} - d_{4}^{-} = \sum_{i=1}^{n} \sum_{j=1}^{S} y_{ij} t_i}{}
	\end{lpformulation}
	It defines $d_{4}^{+}$ using $d_{4}^{-}$, so we need one more independent equation to define one of these variables. Or we can do next trick:
	
	We can say:
	\begin{description}
		\item[$d_{4}^{+}$] Physiotherapists loading daily capacities.
		\item[$d_{4}^{-}$] Deviation terms related to loading physiotherapists below their daily capacities.
	\end{description}
	and finally we will use equations (\ref{eq:constr10a}) and (\ref{eq:constr10b}).}

\footnotetext{The equation number (\ref{eq:constr11}) in the paper was:
	\begin{lpformulation}
		\lpeq*{\sum_{j=1}^{S} y_{ij} \le 1}{j \in \{1, \ldots , S\}}
	\end{lpformulation}
	but it didn't include $i$ index.}


\section{Change absolute value function}\label{sec:absolute}

\textbf{The equation (\ref{eq:constr04}) has the funtion \textit{absolute} value} which is not linear. We should try to change that equation with some linear constraints\footnote{We can see information about how to do this at \url{http://lpsolve.sourceforge.net/5.1/absolute.htm}  or at \url{https://orinanobworld.blogspot.com/2017/02/another-absolute-value-question.html} or at \url{https://orinanobworld.blogspot.com/2012/07/modeling-absolute-values.html}}. 

First we have to define next items:
\begin{description}
	\item[$B_j$] Binary variable, $\forall j \in \{1, \ldots , S\}$.
	\item[$M_0$] Big $M$ parameter, such that $M_0 > \lvert G_j - \overline{G} \rvert$  $\forall j \in \{1, \ldots , S\}$. We can select $M_0$ in this way: 
	
	$h \ge G_j \ge \lvert G_j - \overline{G} \rvert \Rightarrow M_0 = h+1 > \lvert G_j -  \overline{G} \rvert$
\end{description}

and we can change equation (\ref{eq:constr04}) with:
\begin{lpformulation}
	\lpnewsubeq[eq:constr04a]{(G_j - \overline{G}) + M_0 \cdot B_j \ge 0,}{j \in \{1, \ldots , S\};}
	\lpsubeq[eq:constr04b]{-(G_j - \overline{G}) + M_0 \cdot (1 - B_j) \ge 0,}{j \in \{1, \ldots , S\};}
	\lpsubeq[eq:constr04c]{d_{1}^{+} = \sum_{j=1}^{S} (1-2B_j) (G_j - \overline{G})}{}
\end{lpformulation}
But equation (\ref{eq:constr04c}) is not linear.

We can see that:
\begin{itemize}
	\item if $G_j \ge \overline{G} \Longrightarrow (G_j - \overline{G}) \ge 0 \Longrightarrow B_j = 0$
	\item If $G_j < \overline{G} \Longrightarrow (G_j - \overline{G}) < 0 \Longrightarrow B_j = 1$
\end{itemize}


Secondly, \textbf{the equation (\ref{eq:constr07}) has the funtion \textit{absolute} value} which is not linear. We should try to change that equation with some linear constraints.

First we have to define next items:
\begin{description}
	\item[$C_{jk}$] Binary variable, $\forall j \in \{1, \ldots , S\}, \forall k \in \{1, 2\}$.
	\item[$M_k$] Big $M$ parameter, such that $M_k > \lvert N_{jk} - \overline{N}_k \rvert, \forall j \in \{1, \ldots , S\}, \forall k \in \{1, 2\}$. We can select $M_k$ in this way: 
	
	$c \ge N_{jk} \ge \lvert N_{jk} - \overline{N}_k \rvert \Rightarrow M_k = c+1 > \lvert N_{jk} - \overline{N}_k \rvert$
\end{description}

and we can change equation (\ref{eq:constr07}) with:
\begin{lpformulation}
	\lpnewsubeq[eq:constr07a]{(N_{jk} - \overline{N}_k) + M_k \cdot C_{jk} \ge 0,}{j \in \{1, \ldots , S\},  k \in \{1, 2\};}
	\lpsubeq[eq:constr07b]{-(N_{jk} - \overline{N}_k) + M_k \cdot (1 - C_{jk}) \ge 0,}{j \in \{1, \ldots , S\},  k \in \{1, 2\};}
	\lpsubeq[eq:constr07c]{d_{k+1}^{+} = \sum_{j=1}^{S} (1-2C_{jk}) (N_{jk} - \overline{N}_k)}{k \in \{1, 2\}}
\end{lpformulation}
But equation (\ref{eq:constr07c}) is not linear.

We can see that:
\begin{itemize}
	\item If $N_{jk} \ge \overline{N}_k \Longrightarrow (N_{jk} - \overline{N}_k) \ge 0 \Longrightarrow C_{jk} = 0$
	\item If $N_{jk} < \overline{N}_k \Longrightarrow (N_{jk} - \overline{N}_k) < 0 \Longrightarrow C_{jk} = 1$
\end{itemize}


\section{Table errata}
\unsure{REHACER TABLA 3 DEL PAPER}{}

	
\section{Créditos y fuentes.}
	
	\begin{itemize}
		\item Este documento ha sido escrito en \LaTeX con el editor gratuito  \href{https://www.texstudio.org/}{TeXstudio}.
		\item Debo mencionar en este apartado a IBM por proporcionar a la Universidad del País Vasco (UPV/EHU) una licencia académica de CPLEX \texttrademark con la que he podido realizar mis cálculos y avanzar en mis conocimientos.
	\end{itemize}
	
	
	%\phantomsection
	%\addcontentsline{toc}{chapter}{BIBLIOGRAFÍA}
	\bibliographystyle{plain}
	\bibliography{./BibliografiaML}
	
\end{document}
